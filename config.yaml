app:
  out_dir: ./out
  cache_dir: ./cache
  log_level: INFO
network:
  timeout_sec: 12
  max_retries: 4
  backoff_base_sec: 0.6
  jitter_sec: 0.35
  rate_limit_per_sec: 4.0
  cache_mode: snapshot
  cache_ttl_sec: 0
  cache_snapshot_id: ""
universe:
  ohlcv_lookback_days: 120
  liquidity_window: 20
  top_liquidity: 500
  daily_recalc_top: 800
  weekly_full_scan_weekday: 0
  include_daily_value_rank_addon: 200
analysis:
  fractal_n: 4
  atr_period: 14
  rsi_period: 14
  ma_fast: 20
  ma_slow: 200
  bos_buffer_atr: 0.2
  fvg_min_width_atr: 0.3
  ob_min_push_atr: 1.5
  max_zone_age_bars: 120
scoring:
  weights:
    structure_bull: 12
    structure_bear: 10
    bos_recent: 8
    ob_near: 10
    fvg_near: 7
    ob_fvg_confluence: 6
    above_ma200: 6
    above_ma20: 4
    ma20_above_ma200: 5
    rsi_neutral: 4
    rsi_bullish: 5
    macd_bullish: 5
    macd_cross: 3
    volume_surge: 4
    momentum_20_positive: 5
    momentum_60_positive: 6
    ma20_slope_strong: 4
    vol_adj_return_20: 5
  top_detail: 50
regime:
  index_lookback_days: 520
  min_regime_bars: 260
  rs_lookback_days: 60
  atr_spike_mult: 1.8
report:
  title: KOSPI+KOSDAQ Daily Candidates (SMC Context)
  max_table_rows: 500
  chart_lookback: 180
  include_sort_search_js: true
  execution_guide: "이 리포트는 19:00 KST 종가 이후 계산되며, 다음 거래일 시가 기준 실행을 가정합니다."
  tp_sl_conflict_note: "OHLC만 있을 때 TP/SL 동시 터치 시 보수적(Stop 우선) 가정."
trade:
  execution_delay_days: 1
  entry_price_mode: next_open
  force_top_k: 0
  min_score: 3.5
  min_expected_return: 0.02
  min_rr: 1.5
  min_risk_ratio: 0.001
  stop_atr_mult: 1.5
  tp_rr_target: 2.0
  tp_partial_rr: 1.2 # 부분익절을 1.2R로 상향해 잔량 추세 추종 여지 확보
  tp_partial_size: 0.4 # 일부(40%)만 익절해 잔량(60%) 추세 추종 강화
  move_stop_to_entry: true # 부분익절 후 손절을 본전으로 이동해 리스크 축소
  max_hold_days: 30 # 보유기간 제한 완화로 추세 지속 구간 확보
  score_exit_threshold: 2.0
  exit_on_structure_break: true
  structure_break_quality_min: 0.2 # BOS 품질 문턱을 낮춰 구조 붕괴 감지 민감도 강화
  exit_on_score_drop: true
  tp_sl_conflict: conservative
  trail_atr_mult: 1.2 # ATR 트레일링 활성화로 되돌림 구간 방어 강화
  early_exit_rsi_macd_enabled: true
  early_exit_rsi_macd_days: 4
  early_exit_rsi_threshold: 45
  early_exit_macd_hist_threshold: -0.02
  early_exit_bear_trend_enabled: true
  early_exit_ma20_slope_atr_threshold: 0.0
  tp1_risk_reduction_enabled: true
  tp1_stop_atr_buffer: 0.25
  tp1_trail_atr_mult: 1.0 # 1차 익절 이후 잔량에 트레일링 적용
backtest:
  start: '2025-01-01'
  end: '2025-12-31'
  fill_price: next_open
  fee_bps: 8
  slippage_bps: 5
  max_positions: 10
  risk_per_trade: 0.01
  stop_grace_days: 15
  strategy_params:
    threshold: 3.5
    min_room_to_high_atr: 0.75
    room_to_high_levels: [[1.5, 0.75], [2.5, 1.5], [4.0, 2.5]]
    w_momentum_20: 0.75
    w_momentum_60: 1.5
    w_momentum_60_negative: -1.5
    ma20_slope_atr_threshold: 0.15
    trend_gate_ma20_slope_atr_threshold: 0.15
    stop_distance_atr_max: 1.5
    w_ma20_slope: 1.0
    atr_ratio_low: 0.9
    atr_ratio_high: 1.4
    w_atr_ratio_low: 0.75
    w_atr_ratio_high: -1.0
    ob_quality_strong: 2.0
    ob_quality_min: 1.0
    w_ob_quality_strong: 1.0
    w_ob_quality_weak: -0.5
    ob_age_max: 60
    w_ob_age_old: -0.5
    fvg_age_max: 60
    w_fvg_age_old: -0.5
    w_vol_adj_return_20: 1.0
    vol_adj_return_20_threshold: 1.0
    require_positive_momentum_60: true
    ma_slope_gate:
      enabled: true
      ma_fast: 20
      ma_slow: 200
      slope_window: 5
      buy_slope_threshold: 0.015
      sell_slope_threshold: -0.015
      require_close_confirm_for_buy: true
      require_close_confirm_for_sell: true
  tp:
    rr_target: 2.0
    partial_rr: 1.2 # 실거래 설정과 동일하게 부분익절 기준 상향
    partial_size: 0.4 # 부분익절 비중을 줄여 잔량 추세 추종 강화
    move_stop_to_entry: true # 부분익절 후 손절 본전 이동
  strategy: ob_pullback
  symbols: ["005930","000660","035420","051910","035720"] # TOP500
#  symbols: TOP500
  warmup_bars: 260
  max_fetch_count: 6000
